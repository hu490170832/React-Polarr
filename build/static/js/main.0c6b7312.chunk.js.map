{"version":3,"sources":["lib/statisticColor.worker.js","icons/clip.svg","icons/history.svg","icons/color.svg","icons/effect.svg","icons/filter.svg","icons/light.svg","icons/arrowLeft.svg","icons/arrowRight.svg","types/type.tsx","Context.tsx","lib/useFile.tsx","view/Header.tsx","components/Icon.tsx","components/IconButton.tsx","components/Indicator.tsx","lib/util.tsx","render/GLUtil.ts","components/Slider.tsx","view/Footer/Color.tsx","view/Footer/Footer.tsx","render/shader/normal.tsx","render/shader/Color.tsx","render/WebGL.tsx","render/Cavans.tsx","components/ResizeBox.tsx","view/Main.tsx","render/Histogram.tsx","view/Home.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","Worker","symbol","add","EditStatus","ProcessStatus","ActionType","EditType","initialState","editStatus","IDLE","processStatus","none","savePicture","layers","width","window","innerWidth","height","innerHeight","reducer","state","action","type","updateEditStatus","payload","addLayer","layer","source","position","x1","x2","y1","y2","originPosition","updateCanvasSize","finishSavePicture","Context","createContext","dispatch","_action","Provider","props","useReducer","value","children","useFile","onChange","input","document","createElement","useContext","changeHandler","files","length","file","EDTING","useEffect","onchange","Wrapper","styled","div","Button","Header","console","log","onClick","click","require","Icon","name","className","rest","cs","xlinkHref","IconButton","iconName","isActive","isSelected","label","Indicator","mid","min","max","halfRange","percent","style","clipPath","clamp","x","dragable","container","mousedown","mousemove","mouseup","allowX","allowY","minX","maxX","Infinity","minY","maxY","mousedownHandler","e","preventDefault","stopPropagation","move","ev","addEventListener","up","removeEventListener","touchstartHandler","startX","offsetLeft","startY","offsetTop","offsetX","touches","clientX","offsetY","clientY","left","top","createShader","gl","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","error","getShaderInfoLog","deleteShader","initWebGL","vertexSource","fragmentSource","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","createProjection","l","r","t","b","depth","createTexture","texture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","createUniformSetters","createUniformSetter","uniformInfo","location","getUniformLocation","isArray","size","substr","FLOAT","v","uniform1fv","uniform1f","FLOAT_VEC2","uniform2fv","FLOAT_VEC3","uniform3fv","FLOAT_VEC4","uniform4fv","INT","uniform1iv","uniform1i","INT_VEC2","uniform2iv","INT_VEC3","uniform3iv","INT_VEC4","uniform4iv","BOOL","BOOL_VEC2","BOOL_VEC3","BOOL_VEC4","FLOAT_MAT2","uniformMatrix2fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","SAMPLER_2D","SAMPLER_CUBE","Error","toString","uniformSetters","numUniforms","ACTIVE_UNIFORMS","ii","getActiveUniform","createAttributeSetters","attribSetters","createAttribSetter","index","bindBuffer","ARRAY_BUFFER","buffer","enableVertexAttribArray","vertexAttribPointer","numComponents","normalize","stride","offset","numAttribs","ACTIVE_ATTRIBUTES","attribInfo","getActiveAttrib","getAttribLocation","setUniforms","setters","values","Object","keys","forEach","setter","setAttributes","attribs","createFramebufferTexture","number","framebuffers","textures","i","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","texImage2D","RGBA","UNSIGNED_BYTE","framebufferTexture2D","COLOR_ATTACHMENT0","push","deleteFramebuffer","frameBuffer","Array","deleteTexture","Bar","Shadowbar","Point","Slider","point","useRef","bar","shadowbar","range","current","element","barElement","shadowbarElement","offsetWidth","events","undefined","step","Math","round","roundNumber","ref","Color","Footer","useState","id","selected","buttons","setButtons","activeButton","find","item","map","button","key","NormalFilter","vertexBuffer","texCoordBuffer","pixelStorei","UNPACK_FLIP_Y_WEBGL","viewport","useProgram","attributeSetter","uniformSetter","attributes","a_position","a_texCoord","uniforms","u_projection","canvas","ColorFilter","setColor","u_temperature","u_tint","temperature","tint","WebGL","isSave","vertexPoint","Float32Array","fullPoint","texCoordPoint","createBuffer","bufferData","STATIC_DRAW","filters","normalFilter","colorFilter","_width","_height","hasOwnProperty","render","renderCount","activeTexture","TEXTURE0","clear","COLOR_BUFFER_BIT","drawArrays","TRIANGLES","Canvas","getContext","premultipliedAlpha","alpha","antialias","renderer","canvasElement","ResizeBox","worker","StatisticColorWorker","Center","onmessage","data","histogramCanvas","draw","classList","ctx","g","globalCompositeOperation","fillStyle","clearRect","beginPath","moveTo","lineTo","closePath","fill","Histogram","devicePixelRatio","offCanvas","Main","test","image","url","URL","createObjectURL","onload","transform","right","bottom","scaleX","scaleY","rotate","color","revokeObjectURL","src","canvasContainer","appendChild","Uint8ClampedArray","readPixels","toDataURL","a","href","download","postMessage","reactCanvas","content","Home","ReactModal","setAppElement","body","App","Boolean","hostname","match","ReactDOM","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.0c6b7312.chunk.js","sourcesContent":["module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"8b5bcab159e1c917e266.worker.js\");\n};","import SpriteSymbol from \"../../node_modules/svg-baker-runtime/browser-symbol.js\";\nimport sprite from \"../../node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\";\nvar symbol = new SpriteSymbol({\n  \"id\": \"clip\",\n  \"use\": \"clip-usage\",\n  \"viewBox\": \"0 0 1024 1024\",\n  \"content\": \"<symbol class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"clip\\\"><defs><style></style></defs><path d=\\\"M902.978 735.755l-108.188.03V290.534c0-45.134-35.49-81.72-79.27-81.72h-26.74a37.695 37.695 0 00-2.376-.083l-293.638.082H291.61v.028l-7.15.002v-78.825h-.15l-.01-33.46c-.004-21.912-17.237-39.672-38.493-39.668-21.254.005-38.482 17.77-38.478 39.683l.01 33.445h-.01v78.847l-108.204.03c-21.254.005-38.481 17.771-38.478 39.684.005 21.911 17.238 39.672 38.494 39.668l108.188-.03v445.251c0 45.134 35.49 81.72 79.27 81.72h26.74c.786.05 1.577.083 2.376.083l293.638-.082H710.51v-.028l7.15-.002v78.825h.15l.01 33.46c.004 21.912 17.237 39.672 38.493 39.668 21.254-.005 38.482-17.77 38.478-39.683l-.01-33.445h.01v-78.847l108.204-.03c21.254-.005 38.481-17.771 38.478-39.684-.004-21.911-17.238-39.67-38.494-39.667zm-293.77.083H325.383c-20.743 0-40.92-20.966-40.92-42.35V288.193l108.451-.03h283.828c20.742 0 40.919 20.965 40.919 42.349v405.295l-108.451.03z\\\" /></symbol>\"\n});\nvar result = sprite.add(symbol);\nexport default symbol","import SpriteSymbol from \"../../node_modules/svg-baker-runtime/browser-symbol.js\";\nimport sprite from \"../../node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\";\nvar symbol = new SpriteSymbol({\n  \"id\": \"history\",\n  \"use\": \"history-usage\",\n  \"viewBox\": \"0 0 1024 1024\",\n  \"content\": \"<symbol class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"history\\\"><defs><style></style></defs><path d=\\\"M960 511.13a32 32 0 00-64 .12v.75c0 212.08-171.92 384-384 384S128 724.08 128 512s171.92-384 384-384c128.48 0 242.21 63.1 311.92 160H768a32 32 0 000 64h112a32 32 0 0032-32V176a32 32 0 00-64 0v39.69C765.91 122.67 645.81 64 512 64 264.58 64 64 264.58 64 512s200.58 448 448 448 448-200.58 448-448v-.87z\\\" /><path d=\\\"M720 544a32 32 0 00-32-32H512V336a32 32 0 00-32-32 32 32 0 00-32 32v208a32 32 0 0032 32h208a32 32 0 0032-32z\\\" /></symbol>\"\n});\nvar result = sprite.add(symbol);\nexport default symbol","import SpriteSymbol from \"../../node_modules/svg-baker-runtime/browser-symbol.js\";\nimport sprite from \"../../node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\";\nvar symbol = new SpriteSymbol({\n  \"id\": \"color\",\n  \"use\": \"color-usage\",\n  \"viewBox\": \"0 0 1024 1024\",\n  \"content\": \"<symbol class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"color\\\"><defs><style></style></defs><path d=\\\"M505.856 918.016c-177.664 0-322.56-144.896-322.56-322.56 0-220.16 225.28-423.936 293.888-480.768 16.384-13.824 40.448-13.824 56.832 0 69.12 57.344 293.888 260.608 293.888 480.768.512 178.176-143.872 322.56-322.048 322.56zm0-755.712c-57.344 48.64-267.776 240.128-267.776 433.664 0 147.968 120.32 267.776 267.776 267.776s267.776-120.32 267.776-267.776c.512-194.048-210.432-385.536-267.776-433.664z\\\" /><path d=\\\"M453.632 800.768c-2.56 0-5.632-.512-8.192-1.024-79.872-25.6-139.776-92.16-156.672-174.08-3.072-14.848 6.656-29.184 20.992-32.256 14.848-3.072 29.184 6.656 32.256 20.992 12.8 62.464 58.88 113.664 119.808 132.608 14.336 4.608 22.528 19.968 17.92 34.304-4.096 11.776-14.848 19.456-26.112 19.456z\\\" /></symbol>\"\n});\nvar result = sprite.add(symbol);\nexport default symbol","import SpriteSymbol from \"../../node_modules/svg-baker-runtime/browser-symbol.js\";\nimport sprite from \"../../node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\";\nvar symbol = new SpriteSymbol({\n  \"id\": \"effect\",\n  \"use\": \"effect-usage\",\n  \"viewBox\": \"0 0 1024 1024\",\n  \"content\": \"<symbol class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"effect\\\"><defs><style></style></defs><path d=\\\"M570.362 719.538a51.31 51.31 0 01-8.03-.635c-19.09-3.023-34.513-16.367-40.249-34.823l-41.51-133.536a10.813 10.813 0 00-7.116-7.117l-133.537-41.51c-18.456-5.737-31.8-21.16-34.824-40.249-3.023-19.09 4.901-37.881 20.681-49.041l114.174-80.743a10.81 10.81 0 004.569-8.968l-1.788-139.827c-.247-19.327 10.298-36.783 27.52-45.557 17.222-8.773 37.542-7.043 53.031 4.516l112.072 83.634a10.806 10.806 0 009.939 1.574l132.432-44.909c18.309-6.205 38.166-1.571 51.831 12.094 13.667 13.667 18.302 33.527 12.095 51.831l-44.909 132.431a10.809 10.809 0 001.574 9.94l83.634 112.073c11.56 15.49 13.29 35.811 4.515 53.032-8.673 17.022-25.831 27.521-44.892 27.521-.222 0-.443-.002-.666-.005l-139.827-1.787c-3.566.004-6.911 1.663-8.966 4.569L611.372 698.22c-9.586 13.557-24.808 21.317-41.01 21.318zm-194.07-269.146l114.975 35.74a70.802 70.802 0 0146.602 46.602l35.739 114.974 69.52-98.303c13.458-19.032 35.464-30.229 58.72-29.92l120.393 1.538-72.008-96.494a70.803 70.803 0 01-10.311-65.095l38.667-114.022-114.023 38.667a70.798 70.798 0 01-65.094-10.31l-96.495-72.009 1.539 120.391a70.804 70.804 0 01-29.921 58.722l-98.303 69.519zm408.539-223.389l-.012.035.012-.035z\\\" /><path d=\\\"M202.764 892.016c-18.134 0-36.268-6.902-50.072-20.706v-.001c-27.61-27.609-27.61-72.535 0-100.146l203.617-203.617c13.343-13.344 31.126-20.692 50.073-20.692s36.73 7.349 50.073 20.692c27.61 27.61 27.61 72.535 0 100.146L252.837 871.309c-13.805 13.804-31.939 20.707-50.073 20.707zm-7.646-63.134c4.145 4.145 11.147 4.144 15.294 0l203.616-203.616c4.145-4.146 4.145-11.148 0-15.294-2.713-2.713-5.955-3.118-7.646-3.118s-4.934.405-7.646 3.118L195.118 813.589c-4.145 4.144-4.145 11.148 0 15.293z\\\" /></symbol>\"\n});\nvar result = sprite.add(symbol);\nexport default symbol","import SpriteSymbol from \"../../node_modules/svg-baker-runtime/browser-symbol.js\";\nimport sprite from \"../../node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\";\nvar symbol = new SpriteSymbol({\n  \"id\": \"filter\",\n  \"use\": \"filter-usage\",\n  \"viewBox\": \"0 0 1024 1024\",\n  \"content\": \"<symbol class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"filter\\\"><defs><style></style></defs><path d=\\\"M883.021 562.492c-24.307-55.86-68.93-98.93-125.692-121.294a233.101 233.101 0 00-25.979-8.465c14.45-50.643 11.004-104.237-10.212-153.124-24.255-55.891-68.85-98.979-125.598-121.337-56.655-22.26-118.603-21.157-174.431 3.108-55.875 24.287-98.949 68.887-121.277 125.556-11.844 29.966-17.144 61.38-15.75 93.371a227.255 227.255 0 008.457 52.369 231.224 231.224 0 00-33.299 11.541c-55.876 24.278-98.953 68.864-121.296 125.542s-21.277 118.663 3.001 174.54c24.278 55.876 68.863 98.953 125.541 121.295 27.104 10.686 55.419 16.017 83.702 16.017 30.861 0 61.683-6.35 90.839-19.018 26.927-11.7 50.87-28.127 70.964-48.34 21.933 22.188 48.432 39.683 78.14 51.396 27.115 10.683 55.431 16.014 83.717 16.012 30.886-.001 61.735-6.359 90.904-19.045 55.874-24.302 98.954-68.926 121.298-125.635 22.359-56.651 21.283-118.618-3.029-174.489zM355.645 308.959c33.954-86.177 131.726-128.725 217.928-94.855 41.797 16.468 74.656 48.213 92.524 89.389 16.89 38.92 18.486 81.895 4.691 121.814-59.563.8-116.772 25.222-158.762 67.271-21.935-22.093-48.411-39.605-78.245-51.366-26.149-10.309-53.428-15.622-80.716-15.984-13.144-37.84-12.362-78.466 2.58-116.269zm61.472 498.602c-41.178 17.892-86.856 18.676-128.625 2.211-41.768-16.465-74.624-48.21-92.515-89.387s-18.677-86.856-2.212-128.625c16.465-41.768 48.21-74.624 89.387-92.516 21.488-9.337 44.198-14.014 66.942-14.014 20.84 0 41.711 3.929 61.683 11.802 86.223 33.99 128.717 131.79 94.728 218.013-16.466 41.768-48.211 74.624-89.388 92.516zm413.116-92.594c-33.998 86.292-131.843 128.842-218.102 94.857-24.662-9.723-46.281-24.825-63.436-44.144a231.452 231.452 0 0013.629-28.631c22.342-56.678 21.276-118.663-3.002-174.54a232.257 232.257 0 00-10.647-21.399c35.022-38.823 86.709-59.716 139.17-55.231l1.275.109h.111c15.69 1.477 31.223 5.198 46.147 11.051 41.815 16.475 74.711 48.222 92.626 89.394 17.909 41.155 18.703 86.796 2.229 128.534z\\\" /></symbol>\"\n});\nvar result = sprite.add(symbol);\nexport default symbol","import SpriteSymbol from \"../../node_modules/svg-baker-runtime/browser-symbol.js\";\nimport sprite from \"../../node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\";\nvar symbol = new SpriteSymbol({\n  \"id\": \"light\",\n  \"use\": \"light-usage\",\n  \"viewBox\": \"0 0 1024 1024\",\n  \"content\": \"<symbol class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"light\\\"><defs><style></style></defs><path d=\\\"M512 924.605c-110.211 0-213.826-42.917-291.757-120.849-77.93-77.931-120.849-181.545-120.849-291.758 0-110.211 42.92-213.826 120.85-291.756 77.932-77.93 181.546-120.849 291.757-120.849 110.212 0 213.826 42.92 291.757 120.85s120.85 181.545 120.85 291.755c0 110.213-42.918 213.827-120.85 291.758S622.211 924.606 512 924.606zm0-798.594c-212.835 0-385.989 173.153-385.989 385.987 0 212.836 173.154 385.989 385.989 385.989s385.99-173.153 385.99-385.989c0-212.833-173.155-385.987-385.99-385.987z\\\" /><path d=\\\"M850.062 738.367c-6.555 0-12.264-4.843-13.17-11.517l-9.5-69.912c-5.165-38.015-18.768-101.24-30.323-140.938-11.201-38.491-36.06-94.236-54.28-121.729-18.297-27.603-54.908-69.475-79.946-91.433l-47.532-41.68 17.551-20.013 47.53 41.681c26.945 23.63 64.89 67.026 84.584 96.74 19.77 29.828 45.632 87.695 57.651 128.994 11.86 40.745 25.83 105.697 31.141 144.793l9.5 69.911c.989 7.284-4.113 13.99-11.396 14.98-.61.083-1.214.123-1.81.123z\\\" /><path d=\\\"M865.548 339.056a13.255 13.255 0 01-5.036-.995l-65.295-26.73c-35.498-14.53-97.055-34.362-137.219-44.209-38.935-9.544-99.643-15.89-132.559-13.854-33.056 2.043-87.623 12.813-119.156 23.52l-59.862 20.322c-6.96 2.364-14.519-1.362-16.88-8.323s1.363-14.518 8.322-16.88l59.863-20.323c33.934-11.52 90.489-22.682 126.07-24.882 35.724-2.204 98.763 4.33 140.54 14.57 41.225 10.105 104.46 30.484 140.965 45.428l65.295 26.73c6.802 2.784 10.06 10.556 7.275 17.358a13.32 13.32 0 01-12.323 8.268z\\\" /><path d=\\\"M243.111 547.951l-26.106-5.19 12.33-62.004c6.99-35.15 25.602-89.708 41.487-121.622C286.77 327.1 323.953 275.77 353.71 244.71c29.359-30.644 78.626-75.22 109.824-99.366l55.796-43.182c5.812-4.499 14.17-3.435 18.67 2.38 4.498 5.812 3.433 14.17-2.38 18.67l-55.795 43.182c-30.337 23.48-78.29 66.872-106.896 96.73-27.733 28.946-63.58 78.347-78.279 107.873-14.758 29.646-32.714 82.289-39.208 114.952l-12.33 62.002z\\\" /><path d=\\\"M399.912 786.154a13.251 13.251 0 01-8.769-3.302l-47.532-41.68c-26.948-23.632-64.893-67.028-84.584-96.74-19.769-29.826-45.633-87.694-57.652-128.994-11.86-40.752-25.829-105.706-31.14-144.792l-9.499-69.912 26.375-3.582 9.5 69.911c5.164 38.008 18.766 101.232 30.322 140.937 11.202 38.491 36.061 94.236 54.282 121.727 18.294 27.601 54.905 69.473 79.948 91.433l47.53 41.68c5.527 4.846 6.078 13.254 1.233 18.78a13.28 13.28 0 01-10.014 4.534z\\\" /><path d=\\\"M484.856 797.726c-36.535 0-88.891-6.1-125.19-14.999-41.21-10.102-104.447-30.48-140.963-45.427l-65.295-26.73c-6.802-2.785-10.06-10.556-7.275-17.358 2.785-6.802 10.561-10.06 17.358-7.276l65.295 26.73c35.507 14.534 97.064 34.365 137.217 44.208 38.934 9.544 99.64 15.895 132.56 13.856 33.053-2.042 87.62-12.814 119.157-23.52l59.86-20.324c6.96-2.365 14.519 1.362 16.881 8.323 2.363 6.959-1.363 14.517-8.323 16.88l-59.86 20.324c-33.937 11.523-90.491 22.686-126.072 24.885-4.683.288-9.837.428-15.35.428z\\\" /><path d=\\\"M504.672 921.836l-16.29-21.05 55.796-43.18c30.334-23.48 78.288-66.87 106.894-96.73 27.734-28.948 63.581-78.347 78.278-107.874 14.758-29.645 32.712-82.286 39.21-114.952l12.33-62.004c1.433-7.21 8.44-11.891 15.648-10.458 7.21 1.434 11.892 8.44 10.457 15.648l-12.33 62.004c-6.99 35.152-25.601 89.71-41.487 121.622-15.946 32.035-53.128 83.368-82.887 114.426-29.361 30.645-78.627 75.22-109.824 99.365l-55.795 43.183z\\\" /></symbol>\"\n});\nvar result = sprite.add(symbol);\nexport default symbol","import SpriteSymbol from \"../../node_modules/svg-baker-runtime/browser-symbol.js\";\nimport sprite from \"../../node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\";\nvar symbol = new SpriteSymbol({\n  \"id\": \"arrowLeft\",\n  \"use\": \"arrowLeft-usage\",\n  \"viewBox\": \"0 0 1024 1024\",\n  \"content\": \"<symbol class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"arrowLeft\\\"><defs><style></style></defs><path d=\\\"M294.134 512c0-13.701 5.232-27.402 15.667-37.847l328.704-328.694c20.91-20.91 54.804-20.91 75.704 0 20.9 20.9 20.9 54.794 0 75.705L423.363 512l290.836 290.836c20.9 20.9 20.9 54.805 0 75.705-20.9 20.91-54.794 20.91-75.704 0L309.79 549.847c-10.435-10.445-15.657-24.146-15.657-37.847z\\\" /></symbol>\"\n});\nvar result = sprite.add(symbol);\nexport default symbol","import SpriteSymbol from \"../../node_modules/svg-baker-runtime/browser-symbol.js\";\nimport sprite from \"../../node_modules/svg-sprite-loader/runtime/browser-sprite.build.js\";\nvar symbol = new SpriteSymbol({\n  \"id\": \"arrowRight\",\n  \"use\": \"arrowRight-usage\",\n  \"viewBox\": \"0 0 1024 1024\",\n  \"content\": \"<symbol class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" id=\\\"arrowRight\\\"><defs><style></style></defs><path d=\\\"M729.866 512c0 13.701-5.232 27.402-15.667 37.847L385.495 878.541c-20.91 20.91-54.804 20.91-75.704 0-20.9-20.9-20.9-54.794 0-75.705L600.637 512 309.801 221.164c-20.9-20.9-20.9-54.805 0-75.705 20.9-20.91 54.794-20.91 75.704 0L714.21 474.153c10.435 10.445 15.657 24.146 15.657 37.847z\\\" /></symbol>\"\n});\nvar result = sprite.add(symbol);\nexport default symbol","\r\nexport enum EditStatus {\r\n    IDLE,\r\n    EDTING\r\n}\r\n\r\nexport enum ProcessStatus {\r\n    none,\r\n    clip,\r\n    filter,\r\n    light,\r\n    color,\r\n    effect\r\n}\r\n\r\nexport enum ActionType {\r\n    updateEditStatus,\r\n    addLayer,\r\n    updateCanvasSize,\r\n    savePicture,\r\n    finishSavePicture\r\n}\r\n\r\nexport enum EditType {\r\n    none,\r\n    transform\r\n}\r\n\r\n\r\nexport type IdentityObject<T> = {\r\n    [propsName: string]: T;\r\n}\r\n\r\nexport type WebGLRenderer = {\r\n    viewport: () => void;\r\n    program: WebGLProgram | null\r\n}\r\n\r\nexport type ColorRenderer = {\r\n    setColor: (temperature: number, tint?: number) => void;\r\n} & WebGLRenderer;\r\n\r\nexport type MyImage = ImageBitmap | HTMLImageElement | HTMLCanvasElement | HTMLVideoElement;\r\nexport type Position = {\r\n    x1: number\r\n    y1: number\r\n    x2: number\r\n    y2: number\r\n}\r\nexport type Transform = {\r\n    left: number,\r\n    right: number,\r\n    top: number,\r\n    bottom: number,\r\n    scaleX: number,\r\n    scaleY: number,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    rotate: number\r\n}\r\n\r\nexport type Color = {\r\n    temperature: number\r\n    tint?: number\r\n}\r\nexport type Layer = {\r\n    editStatus: EditType;\r\n    source: MyImage;\r\n    position: Position;\r\n    originPosition: Position;\r\n    transform: Transform;\r\n    color: Color\r\n}\r\nexport type StateType = {\r\n    editStatus: EditStatus;\r\n    processStatus: ProcessStatus;\r\n    savePicture: boolean;\r\n    layers :Array<Layer>,\r\n    width: number,\r\n    height: number\r\n}","import React, {createContext, useReducer} from \"react\";\r\nimport {ActionType, EditStatus, Layer, ProcessStatus, StateType} from \"./types/type\";\r\n\r\n\r\nconst initialState: StateType = {\r\n    editStatus: EditStatus.IDLE,\r\n    processStatus: ProcessStatus.none,\r\n    savePicture: false,\r\n    layers: [\r\n\r\n    ],\r\n    width: window.innerWidth,\r\n    height: window.innerHeight - 92,\r\n};\r\n\r\nconst reducer = (state: typeof initialState, action: {type: ActionType, payload: any}) => {\r\n    switch (action.type) {\r\n        case ActionType.updateEditStatus:\r\n            return {\r\n                ...state,\r\n                editStatus: action.payload\r\n            };\r\n        case ActionType.addLayer:\r\n            const layer: Layer = action.payload;\r\n            if (layer.source.width / layer.source.height > state.width / state.height) {\r\n                // 宽适配\r\n                let height = state.width / (layer.source.width / layer.source.height);\r\n                layer.position.x1 = -1;\r\n                layer.position.x2 = 1;\r\n                layer.position.y1 = -height / state.height;\r\n                layer.position.y2 = height / state.height;\r\n                layer.originPosition.x1 = layer.position.x1;\r\n                layer.originPosition.x2 = layer.position.x2;\r\n                layer.originPosition.y1 = layer.position.y1;\r\n                layer.originPosition.y2 = layer.position.y2;\r\n            } else {\r\n                // 高适配\r\n                let width = state.height * (layer.source.width / layer.source.height);\r\n                layer.position.y1 = -1;\r\n                layer.position.y2 = 1;\r\n                layer.position.x1 = -width / state.width;\r\n                layer.position.x2 = width / state.width;\r\n                layer.originPosition.x1 = layer.position.x1;\r\n                layer.originPosition.x2 = layer.position.x2;\r\n                layer.originPosition.y1 = layer.position.y1;\r\n                layer.originPosition.y2 = layer.position.y2;\r\n            }\r\n            return {\r\n                ...state,\r\n                layers: [\r\n                    ...state.layers,\r\n                    action.payload\r\n                ]\r\n            };\r\n        case ActionType.updateCanvasSize:\r\n            return {\r\n                ...state,\r\n                width: action.payload.width,\r\n                height: action.payload.height\r\n            };\r\n        case ActionType.savePicture:\r\n            return {\r\n                ...state,\r\n                savePicture: true\r\n            };\r\n        case ActionType.finishSavePicture:\r\n            return {\r\n                ...state,\r\n                savePicture: false\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport const Context = createContext({state: initialState , dispatch: (_action: {type: ActionType, payload: any}) => {}});\r\n\r\nexport const Provider:React.FC = (props) => {\r\n    const [state, dispatch] = useReducer(reducer, initialState);\r\n    return (\r\n        <Context.Provider value={{state: state, dispatch}}>\r\n            {props.children}\r\n        </Context.Provider>\r\n    )\r\n};","import React, {useContext, useEffect} from 'react';\r\nimport {Context} from \"../Context\";\r\nimport {ActionType, EditStatus} from \"../types/type\";\r\n\r\nconst useFile = (onChange: (file: File) => void) => {\r\n    const input = document.createElement('input');\r\n    const {state, dispatch} = useContext(Context);\r\n    input.type = 'file';\r\n    const changeHandler = () => {\r\n        if (input.files && input.files.length) {\r\n            let file = input.files[0];\r\n            onChange(file);\r\n            dispatch({type: ActionType.updateEditStatus, payload: EditStatus.EDTING});\r\n            input.value = '';\r\n        }\r\n    };\r\n    useEffect(() => {\r\n        input.onchange = changeHandler;\r\n        return () => {\r\n            input.onchange = null\r\n        };\r\n    });\r\n    return {input};\r\n};\r\n\r\nexport {useFile}","import React, {useContext} from 'react';\r\nimport styled from \"styled-components\";\r\nimport {useFile} from \"../lib/useFile\";\r\nimport {ActionType} from \"../types/type\";\r\nimport {Context} from \"../Context\";\r\nconst Wrapper = styled.div`\r\n    display: flex;\r\n    justify-content: space-between;\r\n    background: #111;\r\n`;\r\n\r\nconst Button = styled.div`\r\n    min-width: 50px;\r\n    padding: 10px;\r\n`;\r\n\r\nconst Header: React.FC = (props) => {\r\n    const {input} = useFile((file) => {\r\n        console.log(file);\r\n    });\r\n    const {state, dispatch} = useContext(Context);\r\n    const open = () => {\r\n        input.click();\r\n    };\r\n    const savePicture = () => {\r\n        dispatch({type: ActionType.savePicture, payload: null});\r\n    }\r\n    return (\r\n        <Wrapper>\r\n            <Button onClick={open}>打开</Button>\r\n            <Button onClick={savePicture}>保存</Button>\r\n        </Wrapper>\r\n    )\r\n}\r\n\r\nexport {Header}","import React from 'react';\r\nimport cs from 'classnames'\r\n\r\n// require 一个目录/文件夹\r\nrequire('../icons/clip.svg');\r\nrequire('../icons/history.svg');\r\nrequire('../icons/color.svg');\r\nrequire('../icons/effect.svg');\r\nrequire('../icons/filter.svg');\r\nrequire('../icons/light.svg');\r\nrequire('../icons/arrowLeft.svg');\r\nrequire('../icons/arrowRight.svg');\r\ntype Props = {\r\n    name?: string\r\n} & React.SVGAttributes<SVGElement>\r\n// name = money\r\n// xlinkHref = \"#money\"\r\nconst Icon = (props: Props) => {\r\n    const {name, children, className, ...rest} = props;\r\n    return (\r\n        <svg className={cs('icon', className)} {...rest}>\r\n            {props.name && <use xlinkHref={'#' + props.name}/>}\r\n        </svg>\r\n    )\r\n};\r\n\r\nexport {Icon};","import React from \"react\";\r\nimport styled from \"styled-components\";\r\nimport {Icon} from \"./Icon\";\r\n\r\nconst Wrapper = styled.div`\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-size: 14px;\r\n    .icon {\r\n        width: 30px;\r\n        height: 30px;\r\n        fill: #b4b3af;\r\n        margin-bottom: 5px;\r\n        &.active {\r\n            fill: #fff;\r\n        }\r\n        &.selected {\r\n            fill: #f60;\r\n        }\r\n    }\r\n`;\r\ntype Props = {\r\n    label: string,\r\n    iconName: string,\r\n    isActive: boolean,\r\n    onClick: () => void,\r\n    isSelected: boolean\r\n}\r\nconst IconButton: React.FC<Props> = (props) => {\r\n    return (\r\n        <Wrapper onClick={props.onClick}>\r\n            <Icon name={props.iconName} className={(props.isActive ? 'active' : '') + ' ' + (props.isSelected ? 'selected' : '')}/>\r\n            <div>{props.label}</div>\r\n        </Wrapper>\r\n    )\r\n};\r\n\r\nexport {IconButton};","import React from 'react';\r\nimport styled from \"styled-components\";\r\n\r\nconst Wrapper = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 70px;\r\n    height: 70px;\r\n    background: #f60;\r\n    border-radius: 5px;\r\n    border: 1px solid #fff;\r\n    &.temperature {\r\n        background: linear-gradient(45deg, #f60, #06f);\r\n    }\r\n    > .flex {\r\n        display: flex;\r\n        width: 100%;\r\n        height: 100%;\r\n        flex-direction: column;\r\n        position: relative;\r\n        justify-content: space-between;\r\n        padding: 3px;\r\n        > .value {\r\n            text-align: right;\r\n        }\r\n    }\r\n    > .mask {\r\n        position: absolute;\r\n        left: 0;\r\n        top: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        background: #ffffff33;\r\n    }\r\n`;\r\ntype Props = {\r\n    value: number\r\n    min: number\r\n    max: number\r\n    label: string\r\n    className: string\r\n}\r\nexport const Indicator:React.FC<Props> = (props) => {\r\n    let mid = (props.min + props.max) / 2;\r\n    let halfRange = (props.max - props.min) / 2;\r\n    let percent = props.value > mid ? props.value / halfRange: -props.value / halfRange;\r\n    percent *= 100;\r\n    return (\r\n        <Wrapper className={props.className}>\r\n            <div className=\"flex\">\r\n                <div className=\"value\">\r\n                    {props.value}\r\n                </div>\r\n                <div>\r\n                    {props.label}\r\n                </div>\r\n            </div>\r\n            <div className=\"mask\" style={{\r\n                clipPath: props.value > mid ? `polygon(0% 0%, ${percent}% 0%, 100% ${100 - percent}%, 100% 100%, 0% 0%)` : `polygon(0% 0%, 0% ${percent}%, ${100 - percent}% 100%, 100% 100%, 0% 0%)`\r\n            }}/>\r\n        </Wrapper>\r\n    )\r\n}","import {EditType, Layer, MyImage} from \"../types/type\";\r\n\r\nexport const initLayer = (source: MyImage): Layer => {\r\n    return {\r\n        editStatus: EditType.none,\r\n        source: source,\r\n        position: {\r\n            x1: 0,\r\n            y1: 0,\r\n            x2: 1,\r\n            y2: 1\r\n        },\r\n        originPosition: {\r\n            x1: 0,\r\n            y1: 0,\r\n            x2: 1,\r\n            y2: 1\r\n        },\r\n        transform: {\r\n            left: 0,\r\n            right: 0,\r\n            top: 0,\r\n            bottom: 0,\r\n            scaleX: 1,\r\n            scaleY: 1,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n            rotate: 0\r\n        },\r\n        color: {\r\n            temperature: 0,\r\n            tint: 0\r\n        }\r\n    }\r\n};\r\n\r\nexport const clamp = (x: number, min: number, max: number) => {\r\n    if (x < min) {\r\n        x = min;\r\n    } else if (x > max) {\r\n        x = max;\r\n    }\r\n    return x;\r\n};\r\n\r\nexport const dragable = (container: HTMLElement,\r\n                         mousedown?: (e: MouseEvent | TouchEvent) => void,\r\n                         mousemove?: (offsetX: number, offsetY: number) => void,\r\n                         mouseup?: (e: MouseEvent | TouchEvent) => void,\r\n                         allowX = true,\r\n                         allowY = true,\r\n                         minX = 0,\r\n                         maxX = Infinity,\r\n                         minY = 0,\r\n                         maxY = Infinity) => {\r\n    const mousedownHandler = (e: MouseEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        mousedown && mousedown(e);\r\n        const move = (ev: MouseEvent) => {\r\n        };\r\n\r\n        const up = (ev: MouseEvent) => {\r\n            mouseup && mouseup(ev);\r\n            document.removeEventListener('mousemove', move);\r\n            document.removeEventListener('mouseup', up);\r\n        };\r\n        document.addEventListener('mousemove', move);\r\n        document.addEventListener('mousemove', up);\r\n    };\r\n    const touchstartHandler = (e: TouchEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        mousedown && mousedown(e);\r\n        let startX = container.offsetLeft;\r\n        let startY = container.offsetTop;\r\n        const move = (ev: TouchEvent) => {\r\n            let offsetX = ev.touches[0].clientX - e.touches[0].clientX;\r\n            let offsetY = ev.touches[0].clientY - e.touches[0].clientY;\r\n            let left = minX, top = minY;\r\n            if (allowX) {\r\n                left = ~~clamp(offsetX + startX, minX, maxX);\r\n                container.style.left = left + 'px';\r\n            }\r\n            if (allowY) {\r\n                top = ~~clamp(offsetY + startY, minY, maxY);\r\n                container.style.top = top + 'px';\r\n            }\r\n            mousemove && mousemove(left, top);\r\n        };\r\n\r\n        const up = (ev: TouchEvent) => {\r\n            mouseup && mouseup(ev);\r\n            document.removeEventListener('touchmove', move);\r\n            document.removeEventListener('touchend', up);\r\n        };\r\n        document.addEventListener('touchmove', move);\r\n        document.addEventListener('touchend', up);\r\n    };\r\n    container.addEventListener('mousedown', mousedownHandler);\r\n    container.addEventListener('touchstart', touchstartHandler);\r\n    return {\r\n        'mousedown': mousedownHandler,\r\n        'touchstart': touchstartHandler\r\n    }\r\n};","export function createShader (gl: WebGLRenderingContext | WebGL2RenderingContext, type: GLenum, source: string) {\r\n    let shader = gl.createShader(type);\r\n    if (shader) {\r\n        gl.shaderSource(shader, source);\r\n        gl.compileShader(shader);\r\n        let success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n        if (success) {\r\n            return shader;\r\n        }\r\n        console.error(gl.getShaderInfoLog(shader));\r\n        gl.deleteShader(shader);\r\n    }\r\n}\r\n\r\n\r\nexport function createProgram (gl: WebGLRenderingContext | WebGL2RenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader) {\r\n    let program = gl.createProgram();\r\n    if (program) {\r\n        gl.attachShader(program, vertexShader);\r\n        gl.attachShader(program, fragmentShader);\r\n        gl.linkProgram(program);\r\n        let success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n        if (success) {\r\n            return program;\r\n        }\r\n        console.error(gl.getProgramInfoLog(program));\r\n        gl.deleteProgram(program);\r\n    }\r\n}\r\n\r\n\r\nexport function initWebGL (gl: WebGLRenderingContext | WebGL2RenderingContext, vertexSource: string, fragmentSource: string): WebGLProgram | undefined {\r\n    let vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource);\r\n    let fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\r\n    if (vertexShader && fragmentShader) {\r\n        return createProgram(gl, vertexShader, fragmentShader);\r\n    }\r\n}\r\n\r\n\r\nexport function createProjection (l: number, r: number, t: number, b: number, depth: number) {\r\n    return [\r\n        2 / (r - l), 0, 0, 0,\r\n        0, 2 / (t - b), 0, 0,\r\n        0, 0, 2 / depth, 0,\r\n        -(l + r) / (r - l), -(t + b) / (t - b), -1, 1,\r\n    ];\r\n}\r\n\r\n\r\nexport function createRotateMatrix (center: {x: number, y: number, z: number}, rotate: number, axis: ('x' | 'y' | 'z') = 'z') {\r\n    let cos = Math.cos(rotate * Math.PI / 180);\r\n    let sin = Math.sin(rotate * Math.PI / 180);\r\n    if (!center.z) {\r\n        center.z = 0;\r\n    }\r\n    let ret;\r\n    switch (axis) {\r\n        case 'x':\r\n            ret = new Float32Array([\r\n                1.0, 0.0, 0.0, 0.0,\r\n                0.0, cos, sin, 0.0,\r\n                0.0, -sin, cos, 0.0,\r\n                0.0, (1 - cos) * center.y + sin * center.z, (1 - cos) * center.z - sin * center.y, 1.0\r\n            ]);\r\n            break;\r\n        case 'y':\r\n            ret = new Float32Array([\r\n                cos, 0.0, sin, 0.0,\r\n                0.0, 1.0, 0.0, 0.0,\r\n                -sin, 0.0, cos, 0.0,\r\n                (1 - cos) * center.x + sin * center.z, 0.0, (1 - cos) * center.z - sin * center.x, 1.0\r\n            ]);\r\n            break;\r\n        default:\r\n            ret = new Float32Array([\r\n                cos, sin, 0.0, 0.0,\r\n                -sin, cos, 0.0, 0.0,\r\n                0.0, 0.0, 1.0, 0.0,\r\n                (1 - cos) * center.x + sin * center.y, (1 - cos) * center.y - sin * center.x, 0.0, 1.0,\r\n            ]);\r\n    }\r\n    return ret;\r\n}\r\n\r\n\r\nexport function createTranslateMatrix (tx = 0, ty = 0, tz = 0) {\r\n    return new Float32Array([\r\n        1.0, 0.0, 0.0, 0.0,\r\n        0.0, 1.0, 0.0, 0.0,\r\n        0.0, 0.0, 1.0, 0.0,\r\n        tx, ty, tz, 1.0,\r\n    ]);\r\n}\r\n\r\n\r\nexport function createScaleMatrix (scaleX: number, scaleY: number, scaleZ: number, center = {\r\n    x: 0,\r\n    y: 0,\r\n    z: 0\r\n}) {\r\n    return new Float32Array([\r\n        scaleX, 0.0, 0.0, 0.0,\r\n        0.0, scaleY, 0.0, 0.0,\r\n        0.0, 0.0, 1.0, 0.0,\r\n        -scaleX * center.x + center.x, -scaleY * center.y + center.y, -scaleZ * center.z + center.z, 1.0,\r\n    ]);\r\n}\r\n\r\n\r\nexport function createContrastMatrix (value = 0) {\r\n    return new Float32Array([\r\n        value, 0.0, 0.0, 0.0,\r\n        0.0, value, 0.0, 0.0,\r\n        0.0, 0.0, value, 0.0,\r\n        0.5 * (1 - value), 0.5 * (1 - value), 0.5 * (1 - value), 1.0,\r\n    ]);\r\n}\r\n\r\nexport function createHueRotateMatrix (value = 0) {\r\n    let sin = Math.sin(value * Math.PI / 180);\r\n    let cos = Math.cos(value * Math.PI / 180);\r\n    return new Float32Array([\r\n        0.213 + cos * 0.787 - sin * 0.213, 0.213 - cos * 0.213 + sin * 0.143, 0.213 - cos * 0.213 - sin * 0.787, 0.0,\r\n        0.715 - cos * 0.715 - sin * 0.715, 0.715 + cos * 0.285 + sin * 0.140, 0.715 - cos * 0.715 + sin * 0.715, 0.0,\r\n        0.072 - cos * 0.072 + sin * 0.928, 0.072 - cos * 0.072 - sin * 0.283, 0.072 + cos * 0.928 + sin * 0.072, 0.0,\r\n        0.0, 0.0, 0.0, 1.0,\r\n    ]);\r\n}\r\n\r\nexport function createSaturateMatrix (value = 0) {\r\n    return new Float32Array([\r\n        0.3086 * (1 - value) + value, 0.3086 * (1 - value), 0.3086 * (1 - value), 0.0,\r\n        0.6094 * (1 - value), 0.6094 * (1 - value) + value, 0.6094 * (1 - value), 0.0,\r\n        0.0820 * (1 - value), 0.0820 * (1 - value), 0.0820 * (1 - value) + value, 0.0,\r\n        0.0, 0.0, 0.0, 1.0\r\n    ]);\r\n}\r\n\r\n\r\nexport function createTexture (gl: WebGLRenderingContext | WebGL2RenderingContext) {\r\n    let texture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    return texture;\r\n}\r\n\r\ntype UniformSetter = {}\r\ntype AttributeSetter = {}\r\nexport function createUniformSetters (gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram): UniformSetter {\r\n    function createUniformSetter (program: WebGLProgram, uniformInfo: WebGLActiveInfo) {\r\n        const location = gl.getUniformLocation(program, uniformInfo.name);\r\n        const type = uniformInfo.type;\r\n        // Check if this uniform is an array\r\n        const isArray = (uniformInfo.size > 1 && uniformInfo.name.substr(-3) === '[0]');\r\n        if (type === gl.FLOAT && isArray) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform1fv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.FLOAT) {\r\n            return function (v: number) {\r\n                gl.uniform1f(location, v);\r\n            };\r\n        }\r\n        if (type === gl.FLOAT_VEC2) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform2fv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.FLOAT_VEC3) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform3fv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.FLOAT_VEC4) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform4fv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.INT && isArray) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform1iv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.INT) {\r\n            return function (v: number) {\r\n                gl.uniform1i(location, v);\r\n            };\r\n        }\r\n        if (type === gl.INT_VEC2) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform2iv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.INT_VEC3) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform3iv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.INT_VEC4) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform4iv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.BOOL) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform1iv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.BOOL_VEC2) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform2iv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.BOOL_VEC3) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform3iv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.BOOL_VEC4) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniform4iv(location, v);\r\n            };\r\n        }\r\n        if (type === gl.FLOAT_MAT2) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniformMatrix2fv(location, false, v);\r\n            };\r\n        }\r\n        if (type === gl.FLOAT_MAT3) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniformMatrix3fv(location, false, v);\r\n            };\r\n        }\r\n        if (type === gl.FLOAT_MAT4) {\r\n            return function (v: Iterable<number>) {\r\n                gl.uniformMatrix4fv(location, false, v);\r\n            };\r\n        }\r\n        // if ((type === gl.SAMPLER_2D || type === gl.SAMPLER_CUBE) && isArray) {\r\n        //     const units = [];\r\n        //     for (let ii = 0; ii < info.size; ++ii) {\r\n        //         units.push(textureUnit++);\r\n        //     }\r\n        //     return function () {};\r\n            // return function (bindPoint, units) {\r\n            //     return function (textures) {\r\n            //         gl.uniform1iv(location, units);\r\n            //         textures.forEach(function (texture, index) {\r\n            //             gl.activeTexture(gl.TEXTURE0 + units[index]);\r\n            //             gl.bindTexture(bindPoint, texture);\r\n            //         });\r\n            //     };\r\n            // }(getBindPointForSamplerType(gl, type), units);\r\n        // }\r\n        if (type === gl.SAMPLER_2D || type === gl.SAMPLER_CUBE) {\r\n            return function(){}\r\n            // return function (bindPoint, unit) {\r\n            //     return function (texture) {\r\n            //         gl.uniform1i(location, unit);\r\n            //         gl.activeTexture(gl.TEXTURE0 + unit);\r\n            //         gl.bindTexture(bindPoint, texture);\r\n            //     };\r\n            // }(getBindPointForSamplerType(gl, type), textureUnit++);\r\n        }\r\n        throw new Error('unknown type: 0x' + type.toString(16)); // we should never get here.\r\n    }\r\n\r\n    const uniformSetters = {};\r\n    const numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\r\n\r\n    for (let ii = 0; ii < numUniforms; ++ii) {\r\n        const uniformInfo = gl.getActiveUniform(program, ii);\r\n        if (!uniformInfo) {\r\n            break;\r\n        }\r\n        let name = uniformInfo.name;\r\n        // remove the array suffix.\r\n        if (name.substr(-3) === '[0]') {\r\n            name = name.substr(0, name.length - 3);\r\n        }\r\n        // @ts-ignore\r\n        uniformSetters[name] = createUniformSetter(program, uniformInfo);\r\n    }\r\n    return uniformSetters;\r\n}\r\n\r\n\r\nexport function createAttributeSetters (gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram):AttributeSetter {\r\n    const attribSetters = {\r\n    };\r\n\r\n    function createAttribSetter (index: number) {\r\n        return function (b: {buffer: WebGLBuffer, numComponents: number, type: GLenum, normalize: boolean, stride: number, offset: number}) {\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, b.buffer);\r\n            gl.enableVertexAttribArray(index);\r\n            gl.vertexAttribPointer(\r\n                index, b.numComponents, b.type || gl.FLOAT, b.normalize || false, b.stride || 0, b.offset || 0);\r\n        };\r\n    }\r\n\r\n    const numAttribs = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\r\n    for (let ii = 0; ii < numAttribs; ++ii) {\r\n        const attribInfo = gl.getActiveAttrib(program, ii);\r\n        if (!attribInfo) {\r\n            break;\r\n        }\r\n        const index = gl.getAttribLocation(program, attribInfo.name);\r\n        // @ts-ignore\r\n        attribSetters[attribInfo.name] = createAttribSetter(index);\r\n    }\r\n\r\n    return attribSetters;\r\n}\r\n\r\n\r\n\r\nexport function setUniforms (setters: UniformSetter | any, values: any) {\r\n    setters = setters.uniformSetters || setters;\r\n    Object.keys(values).forEach(function (name) {\r\n        const setter = setters[name];\r\n        if (setter) {\r\n            setter(values[name]);\r\n        }\r\n    });\r\n}\r\n\r\nexport function setAttributes (setters: AttributeSetter | any, attribs: any) {\r\n    setters = setters.attribSetters || setters;\r\n    Object.keys(attribs).forEach(function (name) {\r\n        const setter = setters[name];\r\n        if (setter) {\r\n            setter(attribs[name]);\r\n        }\r\n    });\r\n}\r\n\r\nexport function createFramebufferTexture (gl: WebGLRenderingContext | WebGL2RenderingContext, number: number, width: number, height: number): [WebGLFramebuffer[], WebGLTexture[]] {\r\n    let framebuffers: Array<WebGLFramebuffer> = [];\r\n    let textures: Array<WebGLTexture> = [];\r\n    for (let i = 0; i < number; i++) {\r\n        let framebuffer = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n        let texture = createTexture(gl);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n        texture && textures.push(texture);\r\n        framebuffer && framebuffers.push(framebuffer);\r\n    }\r\n    return [framebuffers, textures];\r\n}\r\n\r\n\r\nexport function deleteFramebuffer(gl: WebGLRenderingContext | WebGL2RenderingContext, frameBuffer: WebGLFramebuffer | WebGLFramebuffer[]): void {\r\n    if (Array.isArray(frameBuffer)) {\r\n        for (let i = 0; i < frameBuffer.length; i++) {\r\n            gl.deleteFramebuffer(frameBuffer[i]);\r\n        }\r\n        frameBuffer.length = 0;\r\n    } else {\r\n        gl.deleteFramebuffer(frameBuffer);\r\n    }\r\n}\r\n\r\n\r\nexport function deleteTexture(gl: WebGLRenderingContext | WebGL2RenderingContext, texture: WebGLTexture | WebGLTexture[]): void {\r\n    if (Array.isArray(texture)) {\r\n        for (let i = 0; i < texture.length; i++) {\r\n            gl.deleteTexture(texture[i]);\r\n        }\r\n        texture.length = 0;\r\n    } else {\r\n        gl.deleteTexture(texture);\r\n    }\r\n}\r\n\r\nexport function mapValue(v1: number, v2: number, w1: number, w2: number): (v: number) => number {\r\n    return function (v) {\r\n        return (w1 - w2) / (v1 - v2) * v + ((w2 * v1 - -w2 * v2) / (v1 - v2));\r\n    }\r\n}\r\n\r\nexport function roundNumber(value: number, step: number) {\r\n    let x = Math.round(value / step);\r\n    return step * x;\r\n}","import React, {useEffect, useRef} from 'react';\r\nimport styled from \"styled-components\";\r\nimport {Icon} from \"./Icon\";\r\nimport {dragable} from \"../lib/util\";\r\nimport {roundNumber} from \"../render/GLUtil\";\r\n\r\nconst Wrapper = styled.div`\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    > .slider-bar {\r\n        flex: 1;\r\n        position: relative;\r\n        margin: 0 10px;\r\n    }\r\n    > .slider-button {\r\n        width: 20px;\r\n        height: 20px;\r\n        fill: #fff;\r\n    }\r\n`;\r\n\r\nconst Bar = styled.div`\r\n    height: 4px;\r\n    background: #fff;\r\n    border-radius: 2px;\r\n`;\r\n\r\n\r\nconst Shadowbar = styled.div`\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100%;\r\n    height: 4px;\r\n    background: #f60;\r\n    border-radius: 2px;\r\n`;\r\n\r\nconst Point = styled.div`    \r\n    width: 20px;\r\n    height: 20px;\r\n    background: #f60;\r\n    border-radius: 50%;\r\n    border: 2px solid #fff;\r\n    position: absolute;\r\n    top: 50%;\r\n    transform: translate(-10px, -50%);\r\n`;\r\n\r\ntype Props = {\r\n    onChange: (value: number) => void;\r\n    value: number\r\n    min: number\r\n    max: number\r\n    step: number\r\n}\r\nexport const Slider:React.FC<Props> = (props) => {\r\n    const point = useRef<HTMLDivElement>(null);\r\n    const bar = useRef<HTMLDivElement>(null);\r\n    const shadowbar = useRef<HTMLDivElement>(null);\r\n    const range = props.max - props.min;\r\n    useEffect(()=> {\r\n        if (point.current && bar.current && shadowbar.current) {\r\n            let element = point.current;\r\n            let barElement = bar.current;\r\n            let shadowbarElement = shadowbar.current;\r\n            let offsetX = ~~((props.value / range) * barElement.offsetWidth);\r\n            element.style.left = offsetX + 'px';\r\n            shadowbarElement.style.width = offsetX + 'px';\r\n            const mousemove = (offsetX: number, offsetY: number) => {\r\n                shadowbarElement.style.width = offsetX + 'px';\r\n                let value = roundNumber((offsetX / barElement.offsetWidth) * range, props.step);\r\n                props.onChange(value);\r\n            };\r\n            let events = dragable(element, undefined, mousemove, undefined, true, false, 0, barElement.offsetWidth);\r\n            return () => {\r\n                element.removeEventListener('mousedown', events['mousedown']);\r\n                element.removeEventListener('touchstart', events['touchstart']);\r\n            }\r\n        }\r\n    }, []);\r\n    return (\r\n        <Wrapper>\r\n            <Icon name=\"arrowLeft\" className=\"slider-button\"/>\r\n            <div className=\"slider-bar\">\r\n                <Bar ref={bar}/>\r\n                <Shadowbar ref={shadowbar}/>\r\n                <Point ref={point}/>\r\n            </div>\r\n            <Icon name=\"arrowRight\" className=\"slider-button\"/>\r\n        </Wrapper>\r\n    )\r\n};","import React from 'react';\r\nimport {Indicator} from \"../../components/Indicator\";\r\nimport {Slider} from \"../../components/Slider\";\r\n\r\nexport const Color:React.FC = (props) => {\r\n    return (\r\n        <div>\r\n            <Slider onChange={(value) => {\r\n            }} min={0} max={100} value={20} step={1}/>\r\n            <Indicator className=\"temperature\" value={0} min={-100} max={100} label=\"色温\"/>\r\n        </div>\r\n    )\r\n};","import React, {useContext, useState} from 'react';\r\nimport {IconButton} from \"../../components/IconButton\";\r\nimport styled from \"styled-components\";\r\nimport {Context} from \"../../Context\";\r\nimport {EditStatus} from \"../../types/type\";\r\nimport {Color} from \"./Color\";\r\n\r\nconst Wrapper = styled.div`\r\n    > .footer-icon {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        background: #111;\r\n    }\r\n`;\r\n\r\nconst Footer: React.FC = () => {\r\n    const {state} = useContext(Context);\r\n    const initButtons = [\r\n        {\r\n            id: 1,\r\n            label: '历史记录',\r\n            selected: false,\r\n            iconName: 'history'\r\n        },\r\n        {\r\n            id: 2,\r\n            label: '裁剪',\r\n            selected: false,\r\n            iconName: 'clip'\r\n        },\r\n        {\r\n            id: 3,\r\n            label: '滤镜',\r\n            selected: false,\r\n            iconName: 'filter'\r\n        },\r\n        {\r\n            id: 4,\r\n            label: '光效',\r\n            selected: false,\r\n            iconName: 'light'\r\n        },\r\n        {\r\n            id: 5,\r\n            label: '色彩',\r\n            selected: true,\r\n            iconName: 'color'\r\n        },\r\n        {\r\n            id: 6,\r\n            label: '特效',\r\n            selected: false,\r\n            iconName: 'effect'\r\n        }\r\n    ];\r\n    const [buttons, setButtons] = useState(initButtons);\r\n\r\n    const onClick = (id: number) => {\r\n        if (state.editStatus !== EditStatus.EDTING) return;\r\n        let button = buttons.map(item => {\r\n            item.selected = item.id === id;\r\n            return item;\r\n        });\r\n        setButtons(button);\r\n    };\r\n    const activeButton = buttons.find(item => item.selected);\r\n    return (\r\n\r\n        <Wrapper>\r\n            <div>\r\n                {\r\n                    activeButton && activeButton.id === 5 ? <Color/> : null\r\n                }\r\n            </div>\r\n            <div className=\"footer-icon\">\r\n\r\n                {buttons.map(button => <IconButton onClick={() => onClick(button.id)}\r\n                                                   key={button.id}\r\n                                                   label={button.label}\r\n                                                   iconName={button.iconName}\r\n                                                   isActive={state.editStatus === EditStatus.EDTING}\r\n                                                   isSelected={button.selected}/>)}\r\n            </div>\r\n        </Wrapper>\r\n    )\r\n};\r\n\r\nexport {Footer}","import {\r\n    initWebGL,\r\n    createAttributeSetters,\r\n    createUniformSetters,\r\n    createProjection,\r\n    setAttributes,\r\n    setUniforms\r\n} from \"../GLUtil\";\r\nimport {WebGLRenderer} from \"../../types/type\";\r\n\r\nexport const NormalFilter = (gl: WebGLRenderingContext | WebGL2RenderingContext, vertexBuffer: WebGLBuffer | null, texCoordBuffer: WebGLBuffer | null): WebGLRenderer => {\r\n    const vertexShader = `\r\n    attribute vec4 a_position;\r\n    attribute vec2 a_texCoord;\r\n    varying vec2 v_texCoord;\r\n    uniform mat4 u_projection;\r\n    void main () {\r\n        gl_Position = u_projection * a_position;\r\n        v_texCoord = a_texCoord;\r\n    }\r\n    `;\r\n    const fragmentShader = `\r\n    precision highp float;\r\n    uniform sampler2D u_texture;\r\n    varying vec2 v_texCoord;\r\n    void main () {\r\n        vec4 color = texture2D(u_texture, v_texCoord);\r\n        gl_FragColor = color;\r\n    }\r\n    `;\r\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\r\n    const program = initWebGL(gl, vertexShader, fragmentShader);\r\n    if (!program) {\r\n        return {\r\n            viewport: () => {},\r\n            program: null\r\n        };\r\n    }\r\n\r\n    gl.useProgram(program);\r\n    const attributeSetter = createAttributeSetters(gl, program);\r\n    const uniformSetter = createUniformSetters(gl, program);\r\n    const attributes = {\r\n        a_position: {\r\n            numComponents: 2,\r\n            buffer: vertexBuffer\r\n        },\r\n        a_texCoord: {\r\n            numComponents: 2,\r\n            buffer: texCoordBuffer\r\n        }\r\n    };\r\n    const uniforms = {\r\n        u_projection: createProjection(-gl.canvas.width / 2, gl.canvas.width / 2, gl.canvas.height / 2, -gl.canvas.height / 2, 1)\r\n    };\r\n\r\n    const viewport = () => {\r\n        uniforms.u_projection = createProjection(-gl.canvas.width / 2, gl.canvas.width / 2, gl.canvas.height / 2, -gl.canvas.height / 2, 1);\r\n        setAttributes(attributeSetter, attributes);\r\n        setUniforms(uniformSetter, uniforms);\r\n    };\r\n\r\n    setAttributes(attributeSetter, attributes);\r\n    setUniforms(uniformSetter, uniforms);\r\n\r\n\r\n    return {\r\n        program,\r\n        viewport\r\n    }\r\n};","import {\r\n    initWebGL,\r\n    createAttributeSetters,\r\n    createUniformSetters,\r\n    createProjection,\r\n    setAttributes,\r\n    setUniforms\r\n} from \"../GLUtil\";\r\nimport {ColorRenderer, WebGLRenderer} from \"../../types/type\";\r\n\r\nexport const ColorFilter = (gl: WebGLRenderingContext | WebGL2RenderingContext, vertexBuffer: WebGLBuffer | null, texCoordBuffer: WebGLBuffer | null): ColorRenderer => {\r\n    const vertexShader = `\r\n    attribute vec4 a_position;\r\n    attribute vec2 a_texCoord;\r\n    varying vec2 v_texCoord;\r\n    uniform mat4 u_projection;\r\n    void main () {\r\n        gl_Position = u_projection * a_position;\r\n        v_texCoord = a_texCoord;\r\n    }\r\n    `;\r\n    const fragmentShader = `\r\n    precision highp float;\r\n    uniform sampler2D u_texture;\r\n    uniform float u_temperature;\r\n    uniform float u_tint;\r\n    varying vec2 v_texCoord;\r\n    \r\n    const lowp vec3 warmFilter = vec3(0.93, 0.54, 0.0);\r\n    const mediump mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.596, -0.274, -0.322, 0.212, -0.523, 0.311);\r\n    const mediump mat3 YIQtoRGB = mat3(1.0, 0.956, 0.621, 1.0, -0.272, -0.647, 1.0, -1.105, 1.702);\r\n    void main () {\r\n        vec4 source = texture2D(u_texture, v_texCoord);\r\n        mediump vec3 yiq = RGBtoYIQ * source.rgb;\r\n        yiq.b = clamp(yiq.b + u_tint*0.5226*0.1, -0.5226, 0.5226);\r\n        lowp vec3 rgb = YIQtoRGB * yiq;\r\n        lowp vec3 processed = vec3(\r\n            (rgb.r < 0.5 ? (2.0 * rgb.r * warmFilter.r) : (1.0 - 2.0 * (1.0 - rgb.r) * (1.0 - warmFilter.r))), //adjusting temperature\r\n            (rgb.g < 0.5 ? (2.0 * rgb.g * warmFilter.g) : (1.0 - 2.0 * (1.0 - rgb.g) * (1.0 - warmFilter.g))), \r\n            (rgb.b < 0.5 ? (2.0 * rgb.b * warmFilter.b) : (1.0 - 2.0 * (1.0 - rgb.b) * (1.0 - warmFilter.b))));\r\n        gl_FragColor = vec4(mix(rgb, processed, u_temperature), source.a);\r\n    }\r\n    `;\r\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\r\n    const program = initWebGL(gl, vertexShader, fragmentShader);\r\n    if (!program) {\r\n        return {\r\n            viewport: () => {},\r\n            program: null,\r\n            setColor: () => {}\r\n        };\r\n    }\r\n\r\n    gl.useProgram(program);\r\n    const attributeSetter = createAttributeSetters(gl, program);\r\n    const uniformSetter = createUniformSetters(gl, program);\r\n    const attributes = {\r\n        a_position: {\r\n            numComponents: 2,\r\n            buffer: vertexBuffer\r\n        },\r\n        a_texCoord: {\r\n            numComponents: 2,\r\n            buffer: texCoordBuffer\r\n        }\r\n    };\r\n    const uniforms = {\r\n        u_projection: createProjection(-gl.canvas.width / 2, gl.canvas.width / 2, gl.canvas.height / 2, -gl.canvas.height / 2, 1),\r\n        u_temperature: 0,\r\n        u_tint: 0\r\n    };\r\n\r\n    const viewport = () => {\r\n        uniforms.u_projection = createProjection(-gl.canvas.width / 2, gl.canvas.width / 2, gl.canvas.height / 2, -gl.canvas.height / 2, 1);\r\n        setAttributes(attributeSetter, attributes);\r\n        setUniforms(uniformSetter, uniforms);\r\n    };\r\n\r\n    const setColor = (temperature: number, tint?: number) => {\r\n        // temperature -100 ~ 100 map to 0 ~ 8000\r\n        temperature = 40 * temperature + 4000;\r\n        uniforms.u_temperature = temperature < 5000 ? 0.0004 * (temperature-5000.0) : 0.00006 * (temperature-5000.0);\r\n        setUniforms(uniformSetter, uniforms);\r\n    };\r\n\r\n    setAttributes(attributeSetter, attributes);\r\n    setUniforms(uniformSetter, uniforms);\r\n\r\n\r\n    return {\r\n        program,\r\n        viewport,\r\n        setColor\r\n    }\r\n};","import {NormalFilter} from \"./shader/normal\";\r\nimport {createFramebufferTexture, createTexture, deleteFramebuffer, deleteTexture} from \"./GLUtil\";\r\nimport {IdentityObject, Layer, WebGLRenderer} from \"../types/type\";\r\nimport {ColorFilter} from \"./shader/Color\";\r\nimport {render} from \"@testing-library/react\";\r\n\r\n\r\nexport const WebGL = (gl: WebGLRenderingContext, isSave: boolean = false) => {\r\n    let width = gl.canvas.width;\r\n    let height = gl.canvas.height;\r\n    let vertexPoint = new Float32Array([\r\n        -width / 2, -height / 2,\r\n        width / 2, -height / 2,\r\n        width / 2, height / 2,\r\n        width / 2, height / 2,\r\n        -width / 2, height / 2,\r\n        -width / 2, -height / 2,\r\n    ]);\r\n    let fullPoint = vertexPoint;\r\n\r\n    const texCoordPoint = new Float32Array([\r\n        0.0, 0.0,\r\n        1.0, 0.0,\r\n        1.0, 1.0,\r\n        1.0, 1.0,\r\n        0.0, 1.0,\r\n        0.0, 0.0\r\n    ]);\r\n\r\n    const vertexBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertexPoint, gl.STATIC_DRAW);\r\n\r\n    const texCoordBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, texCoordPoint, gl.STATIC_DRAW);\r\n\r\n    const filters: IdentityObject<WebGLRenderer> = {\r\n        normalFilter: NormalFilter(gl, vertexBuffer, texCoordBuffer),\r\n        colorFilter: ColorFilter(gl, vertexBuffer, texCoordBuffer)\r\n    };\r\n    let [framebuffers, textures] = createFramebufferTexture(gl, 2, width, height);\r\n    const texture = createTexture(gl);\r\n    const viewport = (_width: number, _height: number) => {\r\n        gl.viewport(0, 0, _width, _height);\r\n        width = _width;\r\n        height = _height;\r\n        deleteFramebuffer(gl, framebuffers);\r\n        deleteTexture(gl, textures);\r\n        [framebuffers, textures] = createFramebufferTexture(gl, 2, width, height);\r\n        vertexPoint = new Float32Array([\r\n            -width / 2, -height / 2,\r\n            width / 2, -height / 2,\r\n            width / 2, height / 2,\r\n            width / 2, height / 2,\r\n            -width / 2, height / 2,\r\n            -width / 2, -height / 2,\r\n        ]);\r\n        fullPoint = vertexPoint;\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, vertexPoint, gl.STATIC_DRAW);\r\n        for (let key in filters) {\r\n            if (filters.hasOwnProperty(key)) {\r\n                let filter = filters[key] as WebGLRenderer;\r\n                filter.viewport();\r\n            }\r\n        }\r\n    };\r\n    const render = (layers: Layer[]): Array<number> => {\r\n        let layer = layers[0];\r\n        let renderCount = 0;\r\n        if (layer) {\r\n            if (!isSave) {\r\n                vertexPoint = new Float32Array([\r\n                    width / 2 * layer.position.x1, height / 2 * layer.position.y1,\r\n                    width / 2 * layer.position.x2, height / 2 * layer.position.y1,\r\n                    width / 2 * layer.position.x2, height / 2 * layer.position.y2,\r\n                    width / 2 * layer.position.x2, height / 2 * layer.position.y2,\r\n                    width / 2 * layer.position.x1, height / 2 * layer.position.y2,\r\n                    width / 2 * layer.position.x1, height / 2 * layer.position.y1,\r\n                ]);\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n                gl.bufferData(gl.ARRAY_BUFFER, vertexPoint, gl.STATIC_DRAW);\r\n            }\r\n            gl.activeTexture(gl.TEXTURE0);\r\n            gl.bindTexture(gl.TEXTURE_2D, texture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, layer.source);\r\n\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffers[renderCount % 2]);\r\n            gl.useProgram(filters.colorFilter.program);\r\n            gl.clear(gl.COLOR_BUFFER_BIT);\r\n            gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n            gl.bindTexture(gl.TEXTURE_2D, textures[renderCount % 2]);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, fullPoint, gl.STATIC_DRAW);\r\n            renderCount++;\r\n\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            filters.normalFilter && gl.useProgram(filters.normalFilter.program);\r\n            gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n            return [~~(width / 2 * (layer.position.x1 + 1)), ~~(height / 2 * (layer.position.y1 + 1)), ~~(width / 2 * (layer.position.x2 + 1)), ~~(height / 2 * (layer.position.y2 + 1))];\r\n        }\r\n\r\n        return [];\r\n\r\n    };\r\n\r\n    return {\r\n        render,\r\n        viewport\r\n    }\r\n\r\n};","import {WebGL} from \"./WebGL\";\r\n\r\nexport const Canvas = (width: number, height: number, isSave: boolean = false) => {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    canvas.style.width = '100%';\r\n    canvas.style.height = '100%';\r\n    const gl = canvas.getContext('webgl', {\r\n        premultipliedAlpha: false,\r\n        alpha: false,\r\n        antialias: true\r\n    });\r\n    if (!gl) return null;\r\n    const renderer = WebGL(gl, isSave);\r\n\r\n    const viewport = (width:number, height: number) => {\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        renderer.viewport(width, height);\r\n    };\r\n    return {\r\n        renderer: renderer,\r\n        canvasElement: canvas,\r\n        gl: gl,\r\n        viewport: viewport\r\n    }\r\n\r\n}","import React, {useContext} from 'react';\r\nimport {Context} from \"../Context\";\r\nimport styled from \"styled-components\";\r\n\r\nconst Wrapper = styled.div`\r\n    position: absolute;\r\n`;\r\nexport const ResizeBox: React.FC = () => {\r\n    const {state, dispatch} = useContext(Context);\r\n    return (\r\n        <Wrapper>\r\n\r\n        </Wrapper>\r\n    )\r\n};","import React, {useContext, useEffect, useRef} from \"react\";\r\nimport styled from \"styled-components\";\r\nimport {useFile} from \"../lib/useFile\";\r\nimport {Context} from \"../Context\";\r\nimport {ActionType, EditStatus, EditType} from \"../types/type\";\r\nimport {Canvas} from \"../render/Cavans\";\r\n// @ts-ignore\r\nimport StatisticColorWorker from '../lib/statisticColor.worker';\r\nimport {Histogram} from \"../render/Histogram\";\r\nimport {initLayer} from \"../lib/util\";\r\nimport {ResizeBox} from \"../components/ResizeBox\";\r\n\r\nconst worker = new StatisticColorWorker();\r\nconst Wrapper = styled.div`\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    overflow: hidden;\r\n`;\r\n\r\nconst Button = styled.button`\r\n    //min-width: 100px;\r\n    display: block;\r\n    padding: 10px;\r\n    margin: 20px auto;\r\n    border-radius: 10px;\r\n    background: #333;\r\n`;\r\nconst Center = styled.div`\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    text-align: center;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n`;\r\nworker.onmessage = (e: any) => {\r\n    let data = e.data;\r\n    histogramCanvas.draw(data[0], data[1], data[2]);\r\n};\r\nconst histogramCanvas = Histogram(360, 150);\r\nconst canvas = Canvas(window.devicePixelRatio * window.innerWidth, window.devicePixelRatio * (window.innerHeight - 92));\r\nconst offCanvas = Canvas(300, 200, true);\r\nconst Main: React.FC = () => {\r\n    const {state, dispatch} = useContext(Context);\r\n    const {input} = useFile((file) => {\r\n        if (/\\.png$/.test(file.name) || /\\.jpe?g$/.test(file.name) || /\\.bmp$/.test(file.name)) {\r\n            let image = document.createElement('img');\r\n            let url = URL.createObjectURL(file);\r\n            image.onload = () => {\r\n                dispatch({type: ActionType.addLayer, payload: initLayer(image)});\r\n                dispatch({type: ActionType.updateCanvasSize, payload: {width: image.width, height: image.height}});\r\n                URL.revokeObjectURL(url);\r\n            };\r\n            image.src = url;\r\n        }\r\n    });\r\n\r\n    const open = () => {\r\n        input.click();\r\n    };\r\n    const canvasContainer = useRef(document.createElement('div'));\r\n    const canvas2d = document.createElement('canvas');\r\n    const ctx = canvas2d.getContext('2d');\r\n    useEffect(() => {\r\n        if (canvasContainer.current !== null) {\r\n            let container = canvasContainer.current;\r\n            if (canvas && container) {\r\n                container.appendChild(canvas.canvasElement);\r\n                container.appendChild(histogramCanvas.canvasElement);\r\n                let [x1, y1, x2, y2] = canvas.renderer.render(state.layers);\r\n                if (x1 !== undefined) {\r\n                    let data = new Uint8ClampedArray((x2 - x1) * (y2 - y1) * 4);\r\n                    canvas.gl.readPixels(x1, y1, x2 - x1, y2 - y1, canvas.gl.RGBA, canvas.gl.UNSIGNED_BYTE, data);\r\n                    if (state.savePicture && offCanvas) {\r\n                        console.log(state);\r\n                        if (offCanvas.canvasElement.width !== state.width || offCanvas.canvasElement.height !== state.height) {\r\n                            offCanvas.viewport(state.width, state.height);\r\n                        }\r\n                        offCanvas.renderer.render(state.layers);\r\n                        let url = offCanvas.canvasElement.toDataURL();\r\n                        let a = document.createElement('a');\r\n                        a.href = url;\r\n                        a.download = '保存图片.png';\r\n                        a.click();\r\n                        dispatch({type: ActionType.finishSavePicture, payload: null});\r\n                    }\r\n\r\n                    worker.postMessage([data, histogramCanvas.canvasElement.height], [data.buffer]);\r\n                }\r\n            }\r\n        }\r\n    });\r\n    const buttons = (\r\n        <div>\r\n            <Button onClick={open}>打开照片</Button>\r\n            <Button>打开样本照片</Button>\r\n        </div>\r\n    );\r\n    const reactCanvas = (\r\n        <Center ref={canvasContainer}>\r\n            {state.layers[0] && state.layers[0].editStatus === EditType.none ? <ResizeBox/> : null}\r\n        </Center>\r\n    );\r\n    const content = state.editStatus === EditStatus.IDLE ? buttons : reactCanvas;\r\n    return (\r\n        <Wrapper>\r\n            {content}\r\n        </Wrapper>\r\n    )\r\n};\r\n\r\nexport {Main}","import {dragable} from \"../lib/util\";\r\n\r\nexport const Histogram = (width: number, height: number) => {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.classList.add('histogram');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    const ctx = canvas.getContext('2d');\r\n    dragable(canvas, (e) => {}, (e) => {console.log('move')});\r\n    const draw = (r: Array<number>, g: Array<number>, b: Array<number>) => {\r\n        let step = width / 256;\r\n        if (ctx) {\r\n            ctx.globalCompositeOperation = 'lighter';\r\n            ctx.fillStyle = '#ff0000';\r\n            ctx.clearRect(0, height - 0, width, height);\r\n            ctx.beginPath();\r\n            ctx.moveTo(0, height - 0);\r\n            for (let i = 0; i < r.length; i++) {\r\n                ctx.lineTo(i * step, height - r[i]);\r\n            }\r\n            ctx.lineTo(width, height - 0);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n\r\n            ctx.fillStyle = '#00ff00';\r\n            ctx.beginPath();\r\n            ctx.moveTo(0, height - 0);\r\n            for (let i = 0; i < g.length; i++) {\r\n                ctx.lineTo(i * step, height - g[i]);\r\n            }\r\n            ctx.lineTo(width, height - 0);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n\r\n\r\n            ctx.fillStyle = '#0000ff';\r\n            ctx.beginPath();\r\n            ctx.moveTo(0, height - 0);\r\n            for (let i = 0; i < b.length; i++) {\r\n                ctx.lineTo(i * step, height - b[i]);\r\n            }\r\n            ctx.lineTo(width, height - 0);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n    }\r\n    return {\r\n        draw,\r\n        canvasElement: canvas\r\n    }\r\n};","import React from 'react';\r\nimport styled from \"styled-components\";\r\nimport { Header } from './Header';\r\nimport {Footer} from \"./Footer/Footer\";\r\nimport {Main} from \"./Main\";\r\nconst Wrapper = styled.div`\r\n    display: flex;\r\n    flex-direction: column;\r\n    width: 100vw;\r\n    height: 100vh;\r\n    background: #000;\r\n`\r\n\r\nconst Home: React.FC = (props) => {\r\n    return (\r\n        <Wrapper>\r\n            <Header/>\r\n            <Main/>\r\n            <Footer/>\r\n        </Wrapper>\r\n    )\r\n}\r\n\r\nexport {Home};","import React from 'react';\r\nimport ReactModal from \"react-modal\";\r\nimport {Home} from './view/Home';\r\nimport {Provider} from \"./Context\";\r\n\r\nReactModal.setAppElement(document.body);\r\nfunction App() {\r\n    return (\r\n        <div className=\"App\">\r\n            <Provider>\r\n                <Home/>\r\n            </Provider>\r\n        </div>\r\n\r\n    );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.scss';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}